# =====================================================
# Memory System Configuration Template
# 记忆系统配置模板
# =====================================================
#
# SECURITY NOTICE / 安全提示:
# - Copy this file to .env and fill in your actual API keys
# - Never commit .env file to version control
# - Keep your API keys secure and private
# - 将此文件复制为.env并填入您的实际API密钥
# - 永远不要将.env文件提交到版本控制
# - 保护好您的API密钥安全
#
# SETUP INSTRUCTIONS / 设置说明:
# 1. cp env.template .env
# 2. Edit .env with your actual values
# 3. The system will automatically load these values
# =====================================================


# ===================
# LLM Configuration / LLM配置
# ===================

LLM_PROVIDER=openai
# evaluation 请用 openai/gpt-4.1-mini 以保证结果可复现性，demo 可使用 x-ai/grok-4-fast 平衡速度/成本/效果
LLM_MODEL=x-ai/grok-4-fast 
LLM_BASE_URL=https://openrouter.ai/api/v1
LLM_API_KEY=sk-or-v1-xxxx
LLM_TEMPERATURE=0.3
LLM_MAX_TOKENS=32768
# openrouter/其他的供应商设置，默认为 default，用 openrouter 的 qwen3 时建议设置为 cerebras
# LLM_OPENROUTER_PROVIDER=cerebras

# ===================
# Vectorize (Embedding) Service Configuration
# ===================

# ---- Primary Vectorize Provider ----
# Provider type: vllm (self-deployed), deepinfra (commercial API)
VECTORIZE_PROVIDER=vllm

# API key for primary provider (use "EMPTY" if not required for vllm service)
VECTORIZE_API_KEY=EMPTY

# Base URL for primary provider
# vLLM service example: http://localhost:8000/v1
# DeepInfra example: https://api.deepinfra.com/v1/openai
VECTORIZE_BASE_URL=http://localhost:8000/v1

# Model name (shared by both primary and fallback providers)
VECTORIZE_MODEL=Qwen/Qwen3-Embedding-4B

# ---- Fallback Vectorize Provider (Optional) ----
# Fallback provider type: vllm, deepinfra, or none (to disable fallback)
# Note: Fallback will be disabled if provider is "none", base_url is empty, 
#       or api_key is empty (for deepinfra provider)
VECTORIZE_FALLBACK_PROVIDER=deepinfra

# API key for fallback provider (required for deepinfra, optional for vllm)
VECTORIZE_FALLBACK_API_KEY=xxxxx

# Base URL for fallback provider (required if fallback is enabled)
VECTORIZE_FALLBACK_BASE_URL=https://api.deepinfra.com/v1/openai

# ===== Common Settings =====
VECTORIZE_TIMEOUT=30
VECTORIZE_MAX_RETRIES=3
VECTORIZE_BATCH_SIZE=10
VECTORIZE_MAX_CONCURRENT=5
VECTORIZE_ENCODING_FORMAT=float

# Vector dimensions for client-side truncation
# Set to 0 to disable truncation and use full model dimensions
# Qwen3-Embedding-4B: full 2560D (DeepInfra) or 3584D (vLLM), recommend truncate to 1024D
# Note: Always uses client-side truncation with L2 re-normalization
VECTORIZE_DIMENSIONS=1024


# ===================
# Rerank Service Configuration
# ===================

# ---- Primary Rerank Provider ----
# Provider type: vllm (self-deployed), deepinfra (commercial API)
RERANK_PROVIDER=vllm

# API key for primary provider (use "EMPTY" if not required for vllm service)
RERANK_API_KEY=EMPTY

# Base URL for primary provider
# vLLM service example: http://localhost:12000/v1/rerank
# DeepInfra example: https://api.deepinfra.com/v1/inference
RERANK_BASE_URL=http://localhost:12000/v1/rerank

# Model name (shared by both primary and fallback providers)
RERANK_MODEL=Qwen/Qwen3-Reranker-4B

# ---- Fallback Rerank Provider (Optional) ----
# Fallback provider type: vllm, deepinfra, or none (to disable fallback)
# Note: Fallback will be disabled if provider is "none", base_url is empty,
#       or api_key is empty (for deepinfra provider)
RERANK_FALLBACK_PROVIDER=deepinfra

# API key for fallback provider (required for deepinfra, optional for vllm)
RERANK_FALLBACK_API_KEY=xxxxx

# Base URL for fallback provider (required if fallback is enabled)
RERANK_FALLBACK_BASE_URL=https://api.deepinfra.com/v1/inference

# ===== Common Settings =====
RERANK_TIMEOUT=30
RERANK_MAX_RETRIES=3
RERANK_BATCH_SIZE=10
RERANK_MAX_CONCURRENT=5


# ===================
# KV Storage Configuration / KV存储配置
# ===================
# KV Storage is used to store complete document data separately from MongoDB indexes.
# KV存储用于将完整文档数据与MongoDB索引分开存储。
#
# Three implementations available / 三种实现可选:
# - inmemory: In-memory storage (default, for development/testing, data lost on restart)
# - redis: Redis storage (production, supports cross-process data sharing, requires Redis)
# - zerog: 0G-Storage (decentralized storage, requires 0g-storage-client CLI tool)
#
# 三种实现:
# - inmemory: 内存存储(默认，开发/测试用，重启后数据丢失)
# - redis: Redis存储(生产环境，支持跨进程数据共享，需要Redis服务)
# - zerog: 0G存储(去中心化存储，需要0g-storage-client命令行工具)

# KV Storage type: inmemory, redis, or zerog
KV_STORAGE_TYPE=inmemory

# ---- 0G-Storage Configuration (required if KV_STORAGE_TYPE=zerog) ----
# 0G存储配置 (当KV_STORAGE_TYPE=zerog时必需)

# Comma-separated write nodes / 逗号分隔的写节点
# ZEROG_NODES=http://35.236.80.213:5678,http://34.102.76.235:5678

# Read node URL / 读节点URL
# ZEROG_READ_NODE=http://34.31.1.26:6789

# RPC endpoint URL / RPC端点URL
# ZEROG_RPC_URL=https://evmrpc-testnet.0g.ai

# Unified stream ID for all collections / 所有集合的统一流ID
# ZEROG_STREAM_ID=000000000000000000000000000000000000000000000000000000000000f2be

# Wallet private key (KEEP SECURE!) / 钱包私钥(请妥善保管!)
# ZEROG_WALLET_KEY=your_private_key_here

# Optional: Command timeout in seconds (default: 30) / 可选: 命令超时秒数(默认30)
# ZEROG_TIMEOUT=30

# Optional: Max retry attempts (default: 3) / 可选: 最大重试次数(默认3)
# ZEROG_MAX_RETRIES=3

# ===================
# Redis Configuration / Redis配置
# ===================
# Required for KV_STORAGE_TYPE=redis or for cache/queue operations
# 当KV_STORAGE_TYPE=redis时必需，或用于缓存/队列操作

REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=8
REDIS_SSL=false
# REDIS_PASSWORD=your_password

# ===================
# MongoDB Configuration / MongoDB配置
# ===================

MONGODB_HOST=localhost
MONGODB_PORT=27017
MONGODB_USERNAME=admin
MONGODB_PASSWORD=memsys123
MONGODB_DATABASE=memsys
MONGODB_URI_PARAMS=socketTimeoutMS=15000&authSource=admin

# ===================
# Elasticsearch Configuration / Elasticsearch配置
# ===================

ES_HOSTS=http://localhost:19200
ES_USERNAME=
ES_PASSWORD=
ES_VERIFY_CERTS=false
SELF_ES_INDEX_NS=memsys

# ===================
# Milvus Configuration / Milvus向量数据库配置
# ===================

MILVUS_HOST=localhost
MILVUS_PORT=19530
SELF_MILVUS_COLLECTION_NS=memsys

# ============================================================
# Startup Data Sync Configuration / 启动数据同步配置
# ============================================================
# Automatically validates and syncs Milvus data against MongoDB on startup
# 启动时自动验证Milvus数据与MongoDB的一致性并同步缺失的数据

# Enable automatic data validation and sync on startup (true/false)
# 是否启用启动时的自动数据验证和同步
STARTUP_SYNC_ENABLED=true

# Number of days to check (validate documents created in last N days)
# 检查最近N天的文档（验证最近N天创建的文档）
# - Set to 0: FULL DATABASE VALIDATION (all documents, slower but comprehensive)
#   设置为0: 全量数据库验证（所有文档，较慢但全面）
# - Set to positive number: Only check recent documents (faster, recommended for quick checks)
#   设置为正数: 仅检查最近的文档（更快，适用于快速检查）
# Examples / 示例:
#   STARTUP_SYNC_DAYS=0   → Full validation (DEFAULT - ensures complete consistency)
#                            全量验证（默认值 - 确保完全一致性）
#   STARTUP_SYNC_DAYS=1   → Last 24 hours (very fast)
#                            最近24小时（非常快）
#   STARTUP_SYNC_DAYS=7   → Last week (quick check)
#                            最近一周（快速检查）
#   STARTUP_SYNC_DAYS=30  → Last month (thorough recent check)
#                            最近一个月（彻底的近期检查）
# Default: 0 (full database sync)
STARTUP_SYNC_DAYS=0

# Enable Milvus validation (true/false)
# 是否启用Milvus验证
STARTUP_SYNC_MILVUS=true

# Enable Elasticsearch validation (true/false)
# 是否启用Elasticsearch验证
# Note: ES sync is not yet implemented, keep this false
# 注意: ES同步尚未实现，保持为false
STARTUP_SYNC_ES=false

# Batch size for sync operations (documents per batch)
# 同步操作的批次大小（每批文档数）
# Default: 500
STARTUP_SYNC_BATCH_SIZE=500

# Maximum documents to sync per type (safety limit)
# 每种类型最多同步的文档数（安全限制）
# Set to 0 for unlimited (use with caution on full validation)
# 设置为0表示无限制（在全量验证时请谨慎使用）
# Default: 10000
STARTUP_SYNC_MAX_DOCS=10000

# ===================
# API Server Configuration / API服务器配置
# ===================

# V3 API Base URL (用于 chat_with_memory.py 等客户端)
API_BASE_URL=http://localhost:1995

# ===================
# Environment & Logging / 环境与日志配置
# ===================

LOG_LEVEL=INFO
ENV=dev
PYTHONASYNCIODEBUG=1
MEMORY_LANGUAGE=en
